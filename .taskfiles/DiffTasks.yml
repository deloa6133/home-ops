---
version: "3"

vars:
  PROJECT_DIR:
    sh: "git rev-parse --show-toplevel"
  PROD_DIR: lab/envs/prod
  STAGE_DIR: lab/envs/stage
  HACK_DIR: "{{.PROJECT_DIR}}/hack"

tasks:
  envs:
    desc: diff prod and stage environments
    dir: "{{.PROJECT_DIR}}"
    cmds:
      - git diff -no-index -- {{.PROD_DIR}} {{.STAGE_DIR}} ':(exclude)*.sops.*' ':(exclude)**/hosts.yml'
    ignore_error: true
  test:
    desc: diff prod and stage environments
    dir: "{{.HACK_DIR}}"
    cmds:
      - bash diff-exclude-list.sh
